<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Frota - Controle de Ve√≠culos</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2196F3">
</head>
<body>
    <div id="app">
        <!-- Tela de Login -->
        <div id="loginScreen" class="screen">
            <div class="login-container">
                <h1>App Frota</h1>
                <p>Controle de Ve√≠culos</p>
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="usuario_id">Usu√°rio ID</label>
                        <input type="text" id="usuario_id" name="usuario_id" required placeholder="Ex: admin">
                    </div>
                    <div class="form-group">
                        <label for="senha">Senha</label>
                        <input type="password" id="senha" name="senha" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
                <div id="loginError" class="error-message"></div>
            </div>
        </div>

        <!-- Tela de Coleta -->
        <div id="coletaScreen" class="screen hidden">
            <header class="header">
                <div>
                    <h1>App Frota - Coleta</h1>
                </div>
                <button id="logoutBtn" class="btn-icon">Sair</button>
            </header>

            <div id="painelNovaColeta" class="form-container">
                <h2>üì¶ Retirar Ve√≠culo</h2>
                <form id="retirarForm">
                    <div class="form-group">
                        <label for="veiculo_id_retirar">Selecione o Ve√≠culo</label>
                        <select id="veiculo_id_retirar" name="veiculo_id" required onchange="carregarDadosVeiculo()">
                            <option value="">-- Carregando ve√≠culos --</option>
                        </select>
                    </div>

                    <div id="veiculoDetalhes" class="veiculo-detalhes hidden">
                        <div class="form-group">
                            <p><strong>Marca:</strong> <span id="detalhe_marca"></span></p>
                            <p><strong>Modelo:</strong> <span id="detalhe_modelo"></span></p>
                            <p><strong>Ano:</strong> <span id="detalhe_ano"></span></p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="km_retirada">KM do Ve√≠culo *</label>
                        <input type="number" id="km_retirada" name="km" placeholder="Ex: 45321" step="0.1" required>
                    </div>

                    <div class="form-group">
                        <label for="obs_retirada">Observa√ß√µes na Retirada</label>
                        <textarea id="obs_retirada" name="observacoes" placeholder="Ex: Carro com pequeno amassado na porta traseira..." rows="3"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary btn-large">
                        üöó Retirar Ve√≠culo
                    </button>
                </form>
            </div>

            <!-- Painel de Viagem Ativa -->
            <div id="painelViagemAtiva" class="form-container hidden">
                <div class="status-coleta">
                    <h2>üöô Ve√≠culo em Uso</h2>
                    <div class="info-veiculo">
                        <p><strong>Marca/Modelo:</strong> <span id="coleta_veiculo_marca"></span> <span id="coleta_veiculo_modelo"></span></p>
                        <p><strong>Placa:</strong> <span id="coleta_veiculo_placa"></span></p>
                        <p><strong>Retirado em:</strong> <span id="coleta_data_retirada"></span></p>
                    </div>
                </div>

                <!-- Inspe√ß√£o do Ve√≠culo -->
                <div class="inspecao-veiculo">
                    <h3>üì∏ Inspe√ß√£o do Ve√≠culo</h3>
                    
                    <!-- Fotos -->
                    <div class="form-group">
                        <label for="fotosColeta">Adicionar Fotos</label>
                        <input type="file" id="fotosColeta" accept="image/*" multiple>
                        <div id="previewFotos" class="preview-fotos"></div>
                    </div>

                    <!-- Avarias -->
                    <div class="form-group">
                        <label for="avisoAvarias">
                            <input type="checkbox" id="avisoAvarias" onchange="toggleAvarias()">
                            H√° avarias/danos no ve√≠culo?
                        </label>
                    </div>

                    <div id="secaoAvarias" class="hidden">
                        <div class="form-group">
                            <label for="descricaoAvarias">Descreva os danos/avarias</label>
                            <textarea id="descricaoAvarias" rows="3" placeholder="Ex: Arranh√£o na porta, pneu furado, etc."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Hist√≥rico de Viagens -->
                <div id="historicoViagens" class="viagens-historico">
                    <h3>üìã Viagens Realizadas</h3>
                    <div id="listaViagens"></div>
                </div>

                <!-- Bot√µes de A√ß√£o -->
                <div class="acoes-coleta">
                    <button id="btnSair" class="btn btn-info btn-large" onclick="iniciarSaida()">
                        ‚û°Ô∏è Sair com Ve√≠culo
                    </button>
                    <button id="btnRetornar" class="btn btn-warning btn-large hidden" onclick="iniciarRetorno()">
                        ‚¨ÖÔ∏è Retornar com Ve√≠culo
                    </button>
                    <button id="btnDevolver" class="btn btn-danger btn-large" onclick="devolverVeiculo()">
                        üîë Devolver Ve√≠culo
                    </button>
                </div>
            </div>

            <!-- Painel de Sa√≠da -->
            <div id="painelSaida" class="form-container hidden">
                <h2>‚û°Ô∏è Registrar Sa√≠da</h2>
                <form id="formSaida">
                    <div class="form-group">
                        <label for="km_saida">Quilometragem Sa√≠da</label>
                        <input type="number" id="km_saida" name="km" step="0.01" required>
                    </div>

                    <div class="form-group">
                        <label for="obs_saida">Observa√ß√µes (opcional)</label>
                        <textarea id="obs_saida" name="observacoes" rows="2"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary btn-large">
                        ‚úÖ Confirmar Sa√≠da
                    </button>
                    <button type="button" class="btn btn-secondary btn-large" onclick="cancelarSaida()">
                        ‚ùå Cancelar
                    </button>
                </form>
            </div>

            <!-- Painel de Retorno -->
            <div id="painelRetorno" class="form-container hidden">
                <h2>‚¨ÖÔ∏è Registrar Retorno</h2>
                <form id="formRetorno">
                    <div class="info-viagem">
                        <p><strong>Viagem #</strong> <span id="numero_viagem_retorno"></span></p>
                        <p><strong>KM Sa√≠da:</strong> <span id="km_saida_display"></span> km</p>
                    </div>

                    <div class="form-group">
                        <label for="km_retorno">Quilometragem Retorno</label>
                        <input type="number" id="km_retorno" name="km" step="0.01" required>
                    </div>

                    <div id="kmRodadoDisplay" class="km-rodado-display"></div>

                    <div class="form-group">
                        <label for="obs_retorno">Observa√ß√µes (opcional)</label>
                        <textarea id="obs_retorno" name="observacoes" rows="2"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary btn-large">
                        ‚úÖ Confirmar Retorno
                    </button>
                    <button type="button" class="btn btn-secondary btn-large" onclick="cancelarRetorno()">
                        ‚ùå Cancelar
                    </button>
                </form>
            </div>

            <!-- Painel de Devolu√ß√£o -->
            <div id="painelDevolucao" class="form-container hidden">
                <h2>üîë Devolver Ve√≠culo</h2>
                
                <div class="secao-dados-retirada">
                    <h3>üìã Dados da Retirada</h3>
                    <div class="info-comparacao">
                        <div class="info-item">
                            <label>KM Retirada:</label>
                            <span id="km_retirada_display" class="destaque">-</span>
                        </div>
                        <div class="info-item">
                            <label>Observa√ß√µes Retirada:</label>
                            <span id="obs_retirada_display" class="observacao">-</span>
                        </div>
                    </div>
                </div>

                <form id="formDevolucao">
                    <h3>üìù Dados da Devolu√ß√£o</h3>
                    
                    <div class="form-group">
                        <label for="km_devolucao">KM do Ve√≠culo na Devolu√ß√£o *</label>
                        <input type="number" id="km_devolucao" name="km" placeholder="Ex: 45512" step="0.1" required>
                    </div>

                    <div id="kmRodadoResumo" class="km-rodado-display"></div>

                    <div class="form-group">
                        <label for="obs_devolucao">Observa√ß√µes na Devolu√ß√£o</label>
                        <textarea id="obs_devolucao" name="observacoes" placeholder="Ex: Carro sem problemas, limpeza feita..." rows="3"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary btn-large">
                        ‚úÖ Confirmar Devolu√ß√£o
                    </button>
                    <button type="button" class="btn btn-secondary btn-large" onclick="cancelarDevolucao()">
                        ‚ùå Cancelar
                    </button>
                </form>
            </div>

                    <div id="observacoesContainer" class="hidden">
                        <div class="form-group">
                            <label for="observacoes">Observa√ß√µes</label>
                        <textarea id="observacoes" name="observacoes" rows="4" placeholder="Descreva as avarias..."></textarea>
                    </div>
                </div>

                    <button type="submit" class="btn btn-primary btn-large">
                        ‚úì Salvar Coleta
                    </button>
                </form>
            </div>

            <!-- Painel de Pr√≥xima Etapa (REMOVIDO - usando novo sistema) -->
            
        </div>

        <!-- Tela de Admin -->
        <div id="adminScreen" class="screen hidden">
            <header class="header">
                <div>
                    <h1>App Frota - Relat√≥rios</h1>
                </div>
                <button id="logoutBtn2" class="btn-icon">Sair</button>
            </header>
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="switchAdminTab('usuarios')">Usu√°rios</button>
                <button class="tab-btn" onclick="switchAdminTab('veiculos')">Ve√≠culos</button>
                <button class="tab-btn" onclick="switchAdminTab('relatorios')">Relat√≥rios</button>
            </div>

            <!-- Abas Admin -->
            <div id="usuariosTab" class="admin-tab active">
                <form id="newUserForm" class="form-container">
                    <h3>Novo Usu√°rio</h3>
                    <div class="form-group">
                        <label for="newUserId">Usu√°rio ID</label>
                        <input type="text" id="newUserId" required placeholder="Ex: MOTO001">
                    </div>
                    <div class="form-group">
                        <label for="newUserName">Nome</label>
                        <input type="text" id="newUserName" required>
                    </div>
                    <div class="form-group">
                        <label for="newUserPassword">Senha</label>
                        <input type="password" id="newUserPassword" required>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="newUserAdmin">
                            <span>Administrador</span>
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary">Criar Usu√°rio</button>
                </form>
                <h3>Usu√°rios Cadastrados</h3>
                <div id="usuariosList" class="list-container"></div>
            </div>

            <div id="veiculosTab" class="admin-tab">
                <form id="newVehicleForm" class="form-container">
                    <h3>Novo Ve√≠culo</h3>
                    <div class="form-group">
                        <label for="newVehiclePlaca">Placa</label>
                        <input type="text" id="newVehiclePlaca" required placeholder="ABC-1234">
                    </div>
                    <div class="form-group">
                        <label for="newVehicleMarca">Marca</label>
                        <input type="text" id="newVehicleMarca" required placeholder="Mercedes, Iveco, etc">
                    </div>
                    <div class="form-group">
                        <label for="newVehicleModelo">Modelo</label>
                        <input type="text" id="newVehicleModelo" required placeholder="Sprinter, Iveco, etc">
                    </div>
                    <div class="form-group">
                        <label for="newVehicleAno">Ano</label>
                        <input type="number" id="newVehicleAno" required min="2000" max="2099">
                    </div>
                    <button type="submit" class="btn btn-primary">Cadastrar Ve√≠culo</button>
                </form>
                <h3>Ve√≠culos Cadastrados</h3>
                <div id="vehiclesList" class="list-container"></div>
            </div>

            <div id="relatoriosTab" class="admin-tab">
                <div class="relatorio-opcoes">
                    <div class="form-group">
                        <label for="usuarioFiltro">Filtrar por Usu√°rio (opcional)</label>
                        <select id="usuarioFiltro" onchange="carregarRelatorioFiltrado()">
                            <option value="">-- Todos os Ve√≠culos (Vis√£o Geral) --</option>
                            <option id="carregandoUsuarios" value="" disabled>Carregando usu√°rios...</option>
                        </select>
                    </div>
                </div>
                <div id="relatorioContent" class="relatorio-container"></div>
                <button onclick="gerarRelatorio()" class="btn btn-primary">
                    üìä Atualizar Relat√≥rio
                </button>
            </div>
        </div>
    </div>

    <script src="js/db.js"></script>
    <script src="js/api.js"></script>
    <script src="js/viagens.js"></script>
    <script src="js/relatorios.js"></script>
    <script src="js/app.js"></script>
    <script src="js/sync.js"></script>
    <script>
        // Script de diagn√≥stico
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úì DOM Carregado');
            console.log('‚úì switchAdminTab existe:', typeof switchAdminTab === 'function');
            console.log('‚úì Total de abas admin:', document.querySelectorAll('.admin-tab').length);
            console.log('‚úì veiculosTab elemento:', document.getElementById('veiculosTab') ? 'encontrado' : 'N√ÉO ENCONTRADO');
            console.log('‚úì newVehicleForm elemento:', document.getElementById('newVehicleForm') ? 'encontrado' : 'N√ÉO ENCONTRADO');
        });
    </script>
</body>
</html>
